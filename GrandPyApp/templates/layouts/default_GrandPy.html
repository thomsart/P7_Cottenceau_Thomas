<!DOCTYPE html>

<html>

    <head>
        <meta charset="utf-8" />
        <!-- <link rel="stylesheet" href="page_GrandPy.css" /> -->
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/page_GrandPy.css') }}" />
        <title>GrandPy-Cottenceau-Thomas</title>
    </head>

    <body>

        <div id="bloc_page">

            <header>
                <h1 class="title">
                    GrandPy Bot le papy robot !
                </h1>
            </header>

            <div id="block_one">
                <p class="intro">
                    GranPy bot est ton cyber grand père,<br />
                    comme tout les séniors ses récits valent de l'or !<br/>
                    Donne lui un lieu, un monument, un édifice...<br/>
                    Il te contera son histoire et te montrera où il se trouve.
                </p>
            </div>























            <div id="block_two">

                <div class="grandpy_img">
                    <img src="static/images/papy_bot.png" alt="GrandPy_Bot" />
                </div>

                <div class="speech_zone">

                    <form id="question">
                        <p>
                            <input type="text" id="userText" name="userText" placeholder="poses ta question ici"></input>
                            <input type="submit" value="Go"></input>
                        </p>
                    </form>

                    <article id="answers">
                        <script type="text/javascript">

                            function postFormData(url, data){
                                // we send the content of the form to the server
                                return fetch(url, {
                                    method: "POST",
                                    body: data
                                })
                                .then(response => response.json())
                                .catch(error => console.log(error));
                            }
    
                            let userInput = document.querySelector("#question");
                            userInput.addEventListener("submit", function (event) {
                                event.preventDefault();
                                postFormData("/ajax", new FormData(userInput))
                                .then(response => {
                                    var answerDiv = document.getElementById("answers");
                                    answerDiv.innerHTML = response[0];
                                    initMap(response[1]);
                                })
                            });
    
                        </script>
                    </article>

                </div>

             











                <div id="map">
                </div>


                <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
                <script src="https://maps.googleapis.com/maps/api/js?key={{gmap_api_key}}&callback=initMap&libraries=places&v=weekly"defer></script>
                <link rel="stylesheet" type="text/css" href="./style.css" />
                <!-- <script src="./app.js"></script> -->
                <script>

                    let map;
                    let service;
                    let infowindow;

                    function initMap(data) {

                        const paris = new google.maps.LatLng(48.85341, 2.3488);
                        infowindow = new google.maps.InfoWindow();
                        map = new google.maps.Map(document.getElementById("map"), {
                            center: paris,
                            zoom: 15,
                        });

                        const request = {
                            query : data,
                            fields: ["name", "geometry"],
                        };

                        service = new google.maps.places.PlacesService(map);
                        service.findPlaceFromQuery(request, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                for (let i = 0; i < results.length; i++) {
                                    createMarker(results[i]);
                                }
                                map.setCenter(results[0].geometry.location);
                            }
                        });

                    }

                    function createMarker(place) {
                        const marker = new google.maps.Marker({
                            map,
                            position: place.geometry.location,
                        });
                        google.maps.event.addListener(marker, "click", () => {
                            infowindow.setContent(place.name);
                            infowindow.open(map);
                        });
                    }

                </script>




            </div>





















            <footer>
                <div id="links">
                    <div class="github">
                        <a href="https://github.com/thomsart/P7_Cottenceau_Thomas"><img src="static/images/github.png" alt="github" /></a>
                    </div>
                    <div class="facebook">
                        <a href="https://www.facebook.com/thomas.cottenceau"><img src="static/images/facebook.png" alt="facebook" /></a>
                    </div>
                    <div class="email">
                        <a href="mailto:psychoid@hotmail.fr"  ><img src="static/images/gmail.png" alt="email" /></a>
                    </div>
                </div>
            </footer>

        </div>

    </body>

</html>
